[![CI pipeline](https://github.com/ShiftLeftSecurity/codepropertygraph/actions/workflows/push.yml/badge.svg)](https://github.com/ShiftLeftSecurity/codepropertygraph/actions/workflows/push.yml)

# c2cpg

An [Eclipse CDT](https://wiki.eclipse.org/CDT/designs/Overview_of_Parsing) based parser for C/C++ that creates code property graphs according to the specification at https://github.com/ShiftLeftSecurity/codepropertygraph .

## Self-published cdt-core dependency
Eclipse cdt-core is unfortunately not published to maven central (instead they use their own repository format called p2 tycho, for which tooling is rather limited). Therefor we re-publish it to [maven central](https://repo1.maven.org/maven2/io/joern/eclipse-cdt-core/) under the `io.joern` organization, so we can use it in joern as well as other downstream projects. 
If you want to upgrade cdt-core, edit the eclipse-cdt/eclipse-cdt-core-publish.sh script and adapt the top two variables (`JAR_URL` and `CUSTOM_RELEASE_VERSION`), then run the script and follow the instructions.
Once it's on maven central, update the version in build.sbt and give it a try!


## Building the code

The build process has been verified on Linux, and it should be possible 
to build on OS X and BSD systems as well. The build process requires
the following prerequisites:

* Java runtime 11
  - Link: http://openjdk.java.net/install/
* Scala build tool (sbt)
  - Link: https://www.scala-sbt.org/

Additional build-time dependencies are automatically downloaded as part
of the build process. To build c2cpg issue the command `sbt stage`.

## Running

To produce a code property graph  issue the command:
```shell script
./c2cpg.sh <path/to/sourceCodeDirectory> --output <path/to/outputCpg>
`````

Additional options are available:
```shell script
./c2cpg.sh <path/to/sourceCodeDirectory> \
                --output <path/to/outputCpg> \
                --include <path/to/include/dir1>,<path/to/include/dir2>
                --define DEF
                --define DEF_VAL=2
```

Run the following to see a complete list of available options:
```shell script
./c2cpg.sh --help
```

## Parser Benchmarks

When run on [the linux kernel sources](https://github.com/torvalds/linux) we got:

```
Overall time: 43 sec for 51805 file(s)
Total parse failures: 0
Number of files with problems: 32940 // those are files with unsupported C or C++ statements (see below) or unresolvable includes
```

on this machine:

```
Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz
RAM 32,0 GB (24 GB for the JVM)
Samsung SSD 970 EVO Plus 1TB
```

Includes for the linux kernel are partly unresolvable. These are files actually not contained in the linux GitHub repository, e.g., stuff in:
  - `drivers/` for `gpu/` and/or `drm/`
  - `fs/` for specific filesystems like `xfs/`

On a smaller system (`Intel(R) Core(TM) i7-8665U CPU @ 1.90GHz, 16GB RAM`) with `-Xmx8GB` we got:

```
Overall time: 2.082 min for 51805 file(s)
Total parse failures: 0
Number of files with problems: 32940
```

## Dealing with Parser problems:
(copied from [here](https://wiki.eclipse.org/CDT/designs/Overview_of_Parsing))

In case a syntax error is encountered in the source a _problem node_ will be generated in the AST. There are four types of problem node:
 - `IASTProblemDeclaration`
 - `IASTProblemExpression`
 - `IASTProblemStatement`
 - `IASTProblemTypeId`

The parser is usually capable of recovering from most syntax errors, generating a problem node and resuming the parse.
Problem nodes may also be generated by the preprocessor, for example if a macro is not used properly or if an included file cannot be found.
